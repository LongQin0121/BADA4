<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPC系统架构详解</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .diagram-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            color: #333;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        .mpc-diagram {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            grid-template-rows: auto auto auto;
            gap: 20px;
            align-items: center;
            margin: 30px 0;
        }
        
        .component {
            background: linear-gradient(145deg, #f0f4f8, #d6e8f5);
            border: 2px solid #4a90e2;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.2);
        }
        
        .component:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(74, 144, 226, 0.3);
        }
        
        .optimizer {
            background: linear-gradient(145deg, #ffd89b, #19547b);
            color: white;
            grid-column: 2;
            grid-row: 1;
            font-weight: bold;
        }
        
        .plant {
            background: linear-gradient(145deg, #a8e6cf, #56ab2f);
            color: white;
            grid-column: 2;
            grid-row: 3;
            font-weight: bold;
        }
        
        .reference {
            background: linear-gradient(145deg, #ffb3ba, #ff6b6b);
            color: white;
            grid-column: 1;
            grid-row: 2;
        }
        
        .output {
            background: linear-gradient(145deg, #c7cedb, #667eea);
            color: white;
            grid-column: 3;
            grid-row: 2;
        }
        
        .measurements {
            background: linear-gradient(145deg, #dcedc1, #42b883);
            color: white;
            grid-column: 2;
            grid-row: 2;
            font-size: 0.9em;
        }
        
        .arrow {
            width: 0;
            height: 0;
            border-style: solid;
            position: absolute;
        }
        
        .arrow-right {
            border-left: 15px solid #4a90e2;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            right: -17px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .arrow-down {
            border-top: 15px solid #4a90e2;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            bottom: -17px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .arrow-up {
            border-bottom: 15px solid #4a90e2;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            top: -17px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .detail-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            color: #333;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .detail-section h3 {
            color: #4a90e2;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #4a90e2;
        }
        
        .highlight {
            background: rgba(74, 144, 226, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4a90e2;
            margin: 15px 0;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .comparison-table th {
            background-color: #4a90e2;
            color: white;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 MPC系统架构详解</h1>
        
        <div class="diagram-container">
            <h2 style="text-align: center; color: #4a90e2; margin-bottom: 30px;">MPC控制系统框图</h2>
            
            <div class="mpc-diagram">
                <div class="component optimizer">
                    <strong>优化器 (Optimizer)</strong><br>
                    • 目标函数 (Objectives)<br>
                    • 系统模型 (Model)<br>
                    • 约束条件 (Constraints)
                    <div class="arrow arrow-down"></div>
                </div>
                
                <div class="component reference">
                    <strong>参考输入</strong><br>
                    (Reference)
                    <div class="arrow arrow-right"></div>
                </div>
                
                <div class="component measurements">
                    <strong>测量反馈</strong><br>
                    (Measurements)<br>
                    传感器数据
                    <div class="arrow arrow-up"></div>
                </div>
                
                <div class="component output">
                    <strong>系统输出</strong><br>
                    (Output)
                </div>
                
                <div class="component plant">
                    <strong>被控对象 P(s)</strong><br>
                    (Plant)
                    <div class="arrow arrow-right"></div>
                </div>
            </div>
        </div>
        
        <div class="detail-section">
            <h3>🔧 各组件详细功能</h3>
            
            <div class="grid-2">
                <div>
                    <h4>📊 优化器 (Optimizer)</h4>
                    <div class="highlight">
                        <strong>核心功能：</strong><br>
                        • 接收当前状态和参考信号<br>
                        • 基于系统模型预测未来行为<br>
                        • 在约束条件下优化目标函数<br>
                        • 输出最优控制序列
                    </div>
                    
                    <div class="code-block">
def mpc_optimizer():
    # 构建优化问题
    minimize: Σ(x[k]-ref[k])² + R·u[k]²
    subject to:
        x[k+1] = A·x[k] + B·u[k]  # 模型
        u_min ≤ u[k] ≤ u_max      # 约束
    
    return optimal_control_sequence
                    </div>
                </div>
                
                <div>
                    <h4>🏭 被控对象 (Plant)</h4>
                    <div class="highlight">
                        <strong>真实系统：</strong><br>
                        • 接收控制输入<br>
                        • 产生实际响应<br>
                        • 可能存在干扰和不确定性<br>
                        • 输出可测量的信号
                    </div>
                    
                    <div class="code-block">
# 真实系统可能是：
- 汽车动力学
- 化工反应器  
- 无人机飞行器
- 建筑HVAC系统
- 机器人关节
                    </div>
                </div>
            </div>
        </div>
        
        <div class="detail-section">
            <h3>🔄 MPC控制循环</h3>
            
            <div class="code-block">
while system_running:
    # 1. 测量当前状态 (Measurements)
    current_state = sensor.get_data()
    
    # 2. 获取参考信号 (Reference)  
    reference = get_setpoint()
    
    # 3. 优化器求解 (Optimizer)
    optimal_controls = solve_mpc(
        current_state=current_state,
        reference=reference,
        model=system_model,
        constraints=system_constraints,
        objectives=performance_objectives
    )
    
    # 4. 执行第一个控制动作
    plant.apply_control(optimal_controls[0])
    
    # 5. 等待下一个控制周期
    wait(sample_time)
    
    # 6. 重复循环 (滚动优化)
            </div>
        </div>
        
        <div class="detail-section">
            <h3>⚙️ 三大核心要素</h3>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>要素</th>
                        <th>作用</th>
                        <th>数学表达</th>
                        <th>实际例子</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>目标函数<br>(Objectives)</strong></td>
                        <td>定义优化目标</td>
                        <td>min Σ[Q(x-r)² + Ru²]</td>
                        <td>最小化跟踪误差<br>+ 控制能耗</td>
                    </tr>
                    <tr>
                        <td><strong>系统模型<br>(Model)</strong></td>
                        <td>预测未来状态</td>
                        <td>x[k+1] = f(x[k], u[k])</td>
                        <td>车辆动力学方程<br>传热传质方程</td>
                    </tr>
                    <tr>
                        <td><strong>约束条件<br>(Constraints)</strong></td>
                        <td>限制可行解</td>
                        <td>g(x,u) ≤ 0</td>
                        <td>速度限制<br>温度范围</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="detail-section">
            <h3>🎯 MPC vs 传统控制</h3>
            
            <div class="grid-2">
                <div>
                    <h4>传统PID控制</h4>
                    <div class="code-block">
Reference → [PID控制器] → Plant → Output
              ↑                    ↓
              ←── Error ← [测量] ←──
                    
特点：
• 简单快速
• 基于误差反馈  
• 难处理约束
• 单变量系统
                    </div>
                </div>
                
                <div>
                    <h4>MPC控制</h4>
                    <div class="code-block">
Reference → [MPC优化器] → Plant → Output
    ↓         ↑    ↑             ↓
    Model  Constraints      Measurements
              
特点：  
• 预测性控制
• 多变量系统
• 天然处理约束
• 基于优化
                    </div>
                </div>
            </div>
        </div>
        
        <div class="detail-section">
            <h3>💡 关键优势</h3>
            
            <div class="highlight">
                <strong>🔮 预测能力：</strong>基于模型预测未来，避免短视决策<br><br>
                <strong>🎛️ 约束处理：</strong>在优化中直接处理各种物理限制<br><br>
                <strong>🎯 多目标优化：</strong>同时考虑性能、安全、经济等多重目标<br><br>
                <strong>🔄 滚动反馈：</strong>每个周期重新优化，自动处理不确定性<br><br>
                <strong>🎚️ 多变量协调：</strong>统一处理多输入多输出系统
            </div>
        </div>
        
        <div class="detail-section">
            <h3>🚀 实际应用领域</h3>
            
            <div class="grid-2">
                <div>
                    <h4>🚗 自动驾驶</h4>
                    <p>路径规划、避障、车辆协调</p>
                    
                    <h4>🏭 工业过程</h4>
                    <p>化工反应器、精馏塔、热处理</p>
                    
                    <h4>🛰️ 航空航天</h4>
                    <p>飞行器控制、卫星姿态控制</p>
                </div>
                
                <div>
                    <h4>🏢 建筑节能</h4>
                    <p>HVAC系统、照明控制、能源管理</p>
                    
                    <h4>🔋 电力系统</h4>
                    <p>微电网、储能调度、需求响应</p>
                    
                    <h4>🤖 机器人</h4>
                    <p>运动规划、协作控制、灵巧操作</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
