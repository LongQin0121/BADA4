<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPC公式关系详解</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            font-size: 2.8em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .formula-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            color: #333;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        .main-formula {
            background: linear-gradient(145deg, #2d3748, #1a202c);
            color: white;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Times New Roman', serif;
            font-size: 1.2em;
            text-align: center;
            margin: 20px 0;
            border: 3px solid #ffd700;
        }
        
        .relationship-diagram {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            color: #333;
            text-align: center;
        }
        
        .formula-flow {
            display: grid;
            grid-template-columns: 1fr auto 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin: 30px 0;
        }
        
        .formula-box {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #3498db;
        }
        
        .arrow {
            font-size: 2em;
            color: #e74c3c;
            font-weight: bold;
        }
        
        .specific-formula {
            border-color: #e74c3c;
            background: linear-gradient(145deg, #ffe6e6, #ffd7d7);
        }
        
        .general-formula {
            border-color: #2ecc71;
            background: linear-gradient(145deg, #e6ffe6, #d7ffd7);
        }
        
        .cost-components {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .component-card {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }
        
        .terminal { border-left-color: #9b59b6; }
        .stage { border-left-color: #f39c12; }
        
        .math-notation {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Times New Roman', serif;
            font-size: 1.1em;
            margin: 10px 0;
            text-align: center;
        }
        
        .interpretation {
            background: rgba(52, 152, 219, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #3498db;
            margin: 10px 0;
            font-style: italic;
        }
        
        .highlight-box {
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #ffd700;
            text-align: center;
        }
        
        .position-diagram {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            color: #333;
        }
        
        .mpc-structure {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .structure-level {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            position: relative;
        }
        
        .level-1 { border-left-color: #e74c3c; }
        .level-2 { border-left-color: #f39c12; margin-left: 20px; }
        .level-3 { border-left-color: #2ecc71; margin-left: 40px; }
        
        .visual-timeline {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            border-radius: 12px;
            color: white;
        }
        
        .time-point {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .comparison-table th {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            .formula-flow {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .arrow {
                transform: rotate(90deg);
            }
            
            .visual-timeline {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔗 MPC公式关系详解</h1>
        
        <div class="highlight-box">
            <h2 style="color: #ffd700; margin-top: 0;">🎯 核心关系</h2>
            <p style="font-size: 1.3em;">
                <strong>一般公式 → 具体形式 → 实际计算</strong><br>
                三者是同一个优化问题的不同层次表达
            </p>
        </div>
        
        <div class="relationship-diagram">
            <h2 style="color: #333; margin-bottom: 25px;">📊 三个公式的层次关系</h2>
            
            <div class="formula-flow">
                <div class="formula-box general-formula">
                    <h3>🔧 通用框架</h3>
                    <div class="math-notation">
                        U*<sub>t</sub> := argmin<sub>U<sub>t</sub></sub> Σ<sup>N-1</sup><sub>k=0</sub> q(x<sub>t+k</sub>, u<sub>t+k</sub>)
                    </div>
                    <p><strong>含义：</strong>抽象的数学框架</p>
                </div>
                
                <div class="arrow">⟹</div>
                
                <div class="formula-box specific-formula">
                    <h3>📋 具体实例</h3>
                    <div class="math-notation">
                        q(x,u) = x<sup>T</sup>Qx + u<sup>T</sup>Ru
                    </div>
                    <p><strong>含义：</strong>二次型代价函数</p>
                </div>
                
                <div class="arrow">⟹</div>
                
                <div class="formula-box">
                    <h3>🧮 完整形式</h3>
                    <div class="math-notation">
                        J<sub>0</sub> = x<sup>T</sup><sub>N</sub>P x<sub>N</sub> + Σ<sup>N-1</sup><sub>k=0</sub>[x<sup>T</sup><sub>k</sub>Qx<sub>k</sub> + u<sup>T</sup><sub>k</sub>Ru<sub>k</sub>]
                    </div>
                    <p><strong>含义：</strong>包含终端代价的完整目标函数</p>
                </div>
            </div>
        </div>
        
        <div class="formula-card">
            <h2 style="text-align: center; color: #333;">🔍 详细解析</h2>
            
            <div class="cost-components">
                <div class="component-card">
                    <h3>📐 公式1：通用MPC框架</h3>
                    <div class="main-formula">
                        U*<sub>t</sub>(x(t)) := argmin<sub>U<sub>t</sub></sub> Σ<sup>N-1</sup><sub>k=0</sub> q(x<sub>t+k</sub>, u<sub>t+k</sub>)<br>
                        subject to constraints
                    </div>
                    <div class="interpretation">
                        <strong>作用：</strong>定义MPC的一般框架<br>
                        <strong>q(x,u)：</strong>抽象的单步代价函数<br>
                        <strong>灵活性：</strong>q可以是任何形式
                    </div>
                </div>
                
                <div class="component-card">
                    <h3>📊 公式2：二次型代价</h3>
                    <div class="math-notation">
                        q(x,u) = x<sup>T</sup>Qx + u<sup>T</sup>Ru
                    </div>
                    <div class="interpretation">
                        <strong>作用：</strong>具体化单步代价函数<br>
                        <strong>形式：</strong>二次型（最常用）<br>
                        <strong>参数：</strong>Q权重状态，R权重控制
                    </div>
                </div>
                
                <div class="component-card terminal">
                    <h3>🎯 公式3：完整目标函数</h3>
                    <div class="math-notation">
                        J<sub>0</sub> = x<sup>T</sup><sub>N</sub>P x<sub>N</sub> + Σ<sup>N-1</sup><sub>k=0</sub>[x<sup>T</sup><sub>k</sub>Qx<sub>k</sub> + u<sup>T</sup><sub>k</sub>Ru<sub>k</sub>]
                    </div>
                    <div class="interpretation">
                        <strong>作用：</strong>完整的目标函数<br>
                        <strong>终端项：</strong>x<sup>T</sup><sub>N</sub>P x<sub>N</sub><br>
                        <strong>阶段项：</strong>Σ[x<sup>T</sup>Qx + u<sup>T</sup>Ru]
                    </div>
                </div>
            </div>
        </div>
        
        <div class="position-diagram">
            <h2 style="color: #333; text-align: center;">🗺️ J在MPC中的位置</h2>
            
            <div class="mpc-structure">
                <div class="structure-level level-1">
                    <strong>🎯 MPC优化问题</strong>
                    <p>minimize J<sub>0</sub>(x(0), U<sub>0</sub>) &nbsp;&nbsp;← <span style="color: #e74c3c; font-weight: bold;">J在这里！</span></p>
                </div>
                
                <div class="structure-level level-2">
                    <strong>📋 约束条件</strong>
                    <p>subject to: 动态约束、状态约束、控制约束</p>
                </div>
                
                <div class="structure-level level-3">
                    <strong>🔢 优化变量</strong>
                    <p>U<sub>0</sub> = {u<sub>0</sub>, u<sub>1</sub>, ..., u<sub>N-1</sub>}</p>
                </div>
            </div>
            
            <div class="visual-timeline">
                <div class="time-point">
                    <strong>k=0</strong><br>
                    x<sup>T</sup><sub>0</sub>Qx<sub>0</sub> + u<sup>T</sup><sub>0</sub>Ru<sub>0</sub>
                </div>
                <div class="time-point">
                    <strong>k=1</strong><br>
                    x<sup>T</sup><sub>1</sub>Qx<sub>1</sub> + u<sup>T</sup><sub>1</sub>Ru<sub>1</sub>
                </div>
                <div class="time-point">
                    <strong>...</strong><br>
                    ...
                </div>
                <div class="time-point">
                    <strong>k=N-1</strong><br>
                    x<sup>T</sup><sub>N-1</sub>Qx<sub>N-1</sub> + u<sup>T</sup><sub>N-1</sub>Ru<sub>N-1</sub>
                </div>
                <div class="time-point">
                    <strong>终端</strong><br>
                    x<sup>T</sup><sub>N</sub>P x<sub>N</sub>
                </div>
            </div>
        </div>
        
        <div class="formula-card">
            <h2 style="text-align: center; color: #333;">🧮 公式展开对应关系</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>符号</th>
                        <th>通用形式</th>
                        <th>具体实例</th>
                        <th>物理含义</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>q(x,u)</strong></td>
                        <td>抽象单步代价</td>
                        <td>x<sup>T</sup>Qx + u<sup>T</sup>Ru</td>
                        <td>状态偏差² + 控制能耗²</td>
                    </tr>
                    <tr>
                        <td><strong>Σ q(...)</strong></td>
                        <td>累积阶段代价</td>
                        <td>Σ[x<sup>T</sup><sub>k</sub>Qx<sub>k</sub> + u<sup>T</sup><sub>k</sub>Ru<sub>k</sub>]</td>
                        <td>预测期内总代价</td>
                    </tr>
                    <tr>
                        <td><strong>终端项</strong></td>
                        <td>隐含在框架中</td>
                        <td>x<sup>T</sup><sub>N</sub>P x<sub>N</sub></td>
                        <td>预测终端状态代价</td>
                    </tr>
                    <tr>
                        <td><strong>J<sub>0</sub></strong></td>
                        <td>完整目标函数</td>
                        <td>终端项 + 阶段项</td>
                        <td>总体优化目标</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="formula-card">
            <h2 style="text-align: center; color: #333;">🔧 实际计算过程</h2>
            
            <div class="cost-components">
                <div class="component-card stage">
                    <h3>1️⃣ 构建完整目标函数</h3>
                    <div class="math-notation">
                        将 q(x,u) = x<sup>T</sup>Qx + u<sup>T</sup>Ru<br>
                        代入 Σ q(...) 得到完整的 J<sub>0</sub>
                    </div>
                </div>
                
                <div class="component-card">
                    <h3>2️⃣ 设置约束条件</h3>
                    <div class="math-notation">
                        x<sub>k+1</sub> = Ax<sub>k</sub> + Bu<sub>k</sub><br>
                        u<sub>min</sub> ≤ u<sub>k</sub> ≤ u<sub>max</sub><br>
                        x<sub>min</sub> ≤ x<sub>k</sub> ≤ x<sub>max</sub>
                    </div>
                </div>
                
                <div class="component-card terminal">
                    <h3>3️⃣ 求解优化问题</h3>
                    <div class="math-notation">
                        U* = argmin J<sub>0</sub>(x<sub>0</sub>, U)<br>
                        输出：最优控制序列
                    </div>
                </div>
            </div>
        </div>
        
        <div class="highlight-box">
            <h2 style="color: #ffd700; margin-top: 0;">💡 关键洞察</h2>
            <div style="font-size: 1.1em; text-align: left; max-width: 800px; margin: 0 auto;">
                <p><strong>🎯 三者关系总结</strong></p>
                <p>• <strong>公式1：</strong>MPC的抽象数学框架</p>
                <p>• <strong>公式2：</strong>最常用的二次型代价函数</p>
                <p>• <strong>公式3：</strong>包含终端代价的完整实现</p>
                <br>
                <p><strong>📍 J的位置</strong></p>
                <p>• J<sub>0</sub> 是MPC优化问题的<strong>目标函数</strong></p>
                <p>• 它出现在 "minimize" 后面</p>
                <p>• 是整个优化问题要最小化的量</p>
                <br>
                <p style="font-style: italic; color: #ffd700; text-align: center;">
                    "J是MPC的心脏——它定义了什么是'最优'"
                </p>
            </div>
        </div>
    </div>
</body>
</html>
